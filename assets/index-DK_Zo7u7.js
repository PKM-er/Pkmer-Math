import{H as st,g as lt,d as ct,e as ht,w as M,f as E,n as $}from"./index-0QvGefo4.js";import{h as Pe,l as We}from"./index-0QvGefo4.js";import{t as A,s as dt,u as pt,l as ut}from"./app-B5jJ2DU_.js";import{o as V}from"./ordinal-Cboi1Yqb.js";import{c as mt}from"./colors-Cc3OSVma.js";import{s as ft}from"./array-DEnAxiAM.js";import{w as gt,c as L}from"./path-CbwjOpE9.js";import{b as xt}from"./bump-ClWOOmqL.js";import{x as yt,y as vt}from"./point-DWREGWZc.js";import{m as T,a as F}from"./min-tv6RD-6E.js";import"./init-Gi6I4Gst.js";function kt(e,t){let n,r=-1,a=-1;if(t===void 0)for(const o of e)++a,o!=null&&(n>o||n===void 0&&o>=o)&&(n=o,r=a);else for(let o of e)(o=t(o,++a,e))!=null&&(n>o||n===void 0&&o>=o)&&(n=o,r=a);return r}const bt=mt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function St(e){return e.source}function zt(e){return e.target}function wt(e){let t=St,n=zt,r=yt,a=vt,o=null,s=null,l=gt(c);function c(){let d;const h=ft.call(arguments),u=t.apply(this,h),g=n.apply(this,h);if(o==null&&(s=e(d=l())),s.lineStart(),h[0]=u,s.point(+r.apply(this,h),+a.apply(this,h)),h[0]=g,s.point(+r.apply(this,h),+a.apply(this,h)),s.lineEnd(),d)return s=null,d+""||null}return c.source=function(d){return arguments.length?(t=d,c):t},c.target=function(d){return arguments.length?(n=d,c):n},c.x=function(d){return arguments.length?(r=typeof d=="function"?d:L(+d),c):r},c.y=function(d){return arguments.length?(a=typeof d=="function"?d:L(+d),c):a},c.context=function(d){return arguments.length?(d==null?o=s=null:s=e(o=d),c):o},c}function Et(){return wt(xt)}const K=typeof navigator<"u"&&navigator.userAgent.includes("Macintosh"),Ct=V(bt),U={autoFit:!1,color:e=>{var t;return Ct(`${((t=e.state)==null?void 0:t.path)||""}`)},duration:500,embedGlobalCSS:!0,fitRatio:.95,maxInitialScale:2,maxWidth:0,nodeMinHeight:16,paddingX:8,scrollForPan:K,spacingHorizontal:80,spacingVertical:5,initialExpandLevel:-1,zoom:!0,pan:!0,toggleRecursively:!1};function Le(e){const t={},n={...e},{color:r,colorFreezeLevel:a}=n;if((r==null?void 0:r.length)===1){const o=r[0];t.color=()=>o}else if(r!=null&&r.length){const o=V(r);t.color=s=>o(`${s.state.path}`)}if(a){const o=t.color||U.color;t.color=s=>(s={...s,state:{...s.state,path:s.state.path.split(".").slice(0,a).join(".")}},o(s))}return["duration","fitRatio","initialExpandLevel","maxInitialScale","maxWidth","nodeMinHeight","paddingX","spacingHorizontal","spacingVertical"].forEach(o=>{const s=n[o];typeof s=="number"&&(t[o]=s)}),["zoom","pan"].forEach(o=>{const s=n[o];s!=null&&(t[o]=!!s)}),t}/*! @gera2ld/jsx-dom v2.2.2 | ISC License */const q=1,G=2,Xt="http://www.w3.org/2000/svg",O="http://www.w3.org/1999/xlink",jt={show:O,actuate:O,href:O},Rt=e=>typeof e=="string"||typeof e=="number",Mt=e=>(e==null?void 0:e.vtype)===q,$t=e=>(e==null?void 0:e.vtype)===G;function j(e,t){let n;if(typeof e=="string")n=q;else if(typeof e=="function")n=G;else throw new Error("Invalid VNode type");return{vtype:n,type:e,props:t}}function At(e){return e.children}const Ot={isSvg:!1};function Y(e,t){Array.isArray(t)||(t=[t]),t=t.filter(Boolean),t.length&&e.append(...t)}function Bt(e,t,n){for(const r in t)if(!(r==="key"||r==="children"||r==="ref"))if(r==="dangerouslySetInnerHTML")e.innerHTML=t[r].__html;else if(r==="innerHTML"||r==="textContent"||r==="innerText"||r==="value"&&["textarea","select"].includes(e.tagName)){const a=t[r];a!=null&&(e[r]=a)}else r.startsWith("on")?e[r.toLowerCase()]=t[r]:Nt(e,r,t[r],n.isSvg)}const It={className:"class",labelFor:"for"};function Nt(e,t,n,r){if(t=It[t]||t,n===!0)e.setAttribute(t,"");else if(n===!1)e.removeAttribute(t);else{const a=r?jt[t]:void 0;a!==void 0?e.setAttributeNS(a,t,n):e.setAttribute(t,n)}}function Dt(e){return e.reduce((t,n)=>t.concat(n),[])}function N(e,t){return Array.isArray(e)?Dt(e.map(n=>N(n,t))):D(e,t)}function D(e,t=Ot){if(e==null||typeof e=="boolean")return null;if(e instanceof Node)return e;if($t(e)){const{type:n,props:r}=e;if(n===At){const o=document.createDocumentFragment();if(r.children){const s=N(r.children,t);Y(o,s)}return o}const a=n(r);return D(a,t)}if(Rt(e))return document.createTextNode(`${e}`);if(Mt(e)){let n;const{type:r,props:a}=e;if(!t.isSvg&&r==="svg"&&(t=Object.assign({},t,{isSvg:!0})),t.isSvg?n=document.createElementNS(Xt,r):n=document.createElement(r),Bt(n,a,t),a.children){let s=t;t.isSvg&&r==="foreignObject"&&(s=Object.assign({},s,{isSvg:!1}));const l=N(a.children,s);l!=null&&Y(n,l)}const{ref:o}=a;return typeof o=="function"&&o(n),n}throw new Error("mount: Invalid Vnode!")}function B(e){return D(e)}function Ht(e){var t=0,n=e.children,r=n&&n.length;if(!r)t=1;else for(;--r>=0;)t+=n[r].value;e.value=t}function Lt(){return this.eachAfter(Ht)}function Tt(e){var t=this,n,r=[t],a,o,s;do for(n=r.reverse(),r=[];t=n.pop();)if(e(t),a=t.children,a)for(o=0,s=a.length;o<s;++o)r.push(a[o]);while(r.length);return this}function Ft(e){for(var t=this,n=[t],r,a;t=n.pop();)if(e(t),r=t.children,r)for(a=r.length-1;a>=0;--a)n.push(r[a]);return this}function Yt(e){for(var t=this,n=[t],r=[],a,o,s;t=n.pop();)if(r.push(t),a=t.children,a)for(o=0,s=a.length;o<s;++o)n.push(a[o]);for(;t=r.pop();)e(t);return this}function Pt(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,a=r&&r.length;--a>=0;)n+=r[a].value;t.value=n})}function Wt(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function Vt(e){for(var t=this,n=Kt(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var a=r.length;e!==n;)r.splice(a,0,e),e=e.parent;return r}function Kt(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),a=null;for(e=n.pop(),t=r.pop();e===t;)a=e,e=n.pop(),t=r.pop();return a}function Ut(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function qt(){var e=[];return this.each(function(t){e.push(t)}),e}function Gt(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function Zt(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function H(e,t){var n=new R(e),r=+e.value&&(n.value=e.value),a,o=[n],s,l,c,d;for(t==null&&(t=_t);a=o.pop();)if(r&&(a.value=+a.data.value),(l=t(a.data))&&(d=l.length))for(a.children=new Array(d),c=d-1;c>=0;--c)o.push(s=a.children[c]=new R(l[c])),s.parent=a,s.depth=a.depth+1;return n.eachBefore(te)}function Jt(){return H(this).eachBefore(Qt)}function _t(e){return e.children}function Qt(e){e.data=e.data.data}function te(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function R(e){this.data=e,this.depth=this.height=0,this.parent=null}R.prototype=H.prototype={constructor:R,count:Lt,each:Tt,eachAfter:Yt,eachBefore:Ft,sum:Pt,sort:Wt,path:Vt,ancestors:Ut,descendants:qt,leaves:Gt,links:Zt,copy:Jt};const ee="d3-flextree",ne="2.1.2",re="build/d3-flextree.js",ae="index",ie={name:"Chris Maloney",url:"http://chrismaloney.org"},oe="Flexible tree layout algorithm that allows for variable node sizes.",se=["d3","d3-module","layout","tree","hierarchy","d3-hierarchy","plugin","d3-plugin","infovis","visualization","2d"],le="https://github.com/klortho/d3-flextree",ce="WTFPL",he={type:"git",url:"https://github.com/klortho/d3-flextree.git"},de={clean:"rm -rf build demo test","build:demo":"rollup -c --environment BUILD:demo","build:dev":"rollup -c --environment BUILD:dev","build:prod":"rollup -c --environment BUILD:prod","build:test":"rollup -c --environment BUILD:test",build:"rollup -c",lint:"eslint index.js src","test:main":"node test/bundle.js","test:browser":"node test/browser-tests.js",test:"npm-run-all test:*",prepare:"npm-run-all clean build lint test"},pe={"d3-hierarchy":"^1.1.5"},ue={"babel-plugin-external-helpers":"^6.22.0","babel-preset-es2015-rollup":"^3.0.0",d3:"^4.13.0","d3-selection-multi":"^1.0.1",eslint:"^4.19.1",jsdom:"^11.6.2","npm-run-all":"^4.1.2",rollup:"^0.55.3","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-copy":"^0.2.3","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.2","rollup-plugin-uglify":"^3.0.0","uglify-es":"^3.3.9"},me={name:ee,version:ne,main:re,module:ae,"jsnext:main":"index",author:ie,description:oe,keywords:se,homepage:le,license:ce,repository:he,scripts:de,dependencies:pe,devDependencies:ue},{version:fe}=me,ge=Object.freeze({children:e=>e.children,nodeSize:e=>e.data.size,spacing:0});function J(e){const t=Object.assign({},ge,e);function n(l){const c=t[l];return typeof c=="function"?c:()=>c}function r(l){const c=s(o(),l,d=>d.children);return c.update(),c.data}function a(){const l=n("nodeSize"),c=n("spacing");return class Z extends H.prototype.constructor{constructor(h){super(h)}copy(){const h=s(this.constructor,this,u=>u.children);return h.each(u=>u.data=u.data.data),h}get size(){return l(this)}spacing(h){return c(this,h)}get nodes(){return this.descendants()}get xSize(){return this.size[0]}get ySize(){return this.size[1]}get top(){return this.y}get bottom(){return this.y+this.ySize}get left(){return this.x-this.xSize/2}get right(){return this.x+this.xSize/2}get root(){const h=this.ancestors();return h[h.length-1]}get numChildren(){return this.hasChildren?this.children.length:0}get hasChildren(){return!this.noChildren}get noChildren(){return this.children===null}get firstChild(){return this.hasChildren?this.children[0]:null}get lastChild(){return this.hasChildren?this.children[this.numChildren-1]:null}get extents(){return(this.children||[]).reduce((h,u)=>Z.maxExtents(h,u.extents),this.nodeExtents)}get nodeExtents(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}static maxExtents(h,u){return{top:Math.min(h.top,u.top),bottom:Math.max(h.bottom,u.bottom),left:Math.min(h.left,u.left),right:Math.max(h.right,u.right)}}}}function o(){const l=a(),c=n("nodeSize"),d=n("spacing");return class extends l{constructor(h){super(h),Object.assign(this,{x:0,y:0,relX:0,prelim:0,shift:0,change:0,lExt:this,lExtRelX:0,lThr:null,rExt:this,rExtRelX:0,rThr:null})}get size(){return c(this.data)}spacing(h){return d(this.data,h.data)}get x(){return this.data.x}set x(h){this.data.x=h}get y(){return this.data.y}set y(h){this.data.y=h}update(){return _(this),Q(this),this}}}function s(l,c,d){const h=(u,g)=>{const x=new l(u);Object.assign(x,{parent:g,depth:g===null?0:g.depth+1,height:0,length:1});const m=d(u)||[];return x.children=m.length===0?null:m.map(y=>h(y,x)),x.children&&Object.assign(x,x.children.reduce((y,f)=>({height:Math.max(y.height,f.height+1),length:y.length+f.length}),x)),x};return h(c,null)}return Object.assign(r,{nodeSize(l){return arguments.length?(t.nodeSize=l,r):t.nodeSize},spacing(l){return arguments.length?(t.spacing=l,r):t.spacing},children(l){return arguments.length?(t.children=l,r):t.children},hierarchy(l,c){const d=typeof c>"u"?t.children:c;return s(a(),l,d)},dump(l){const c=n("nodeSize"),d=h=>u=>{const g=h+"  ",x=h+"    ",{x:m,y}=u,f=c(u),k=u.children||[],v=k.length===0?" ":`,${g}children: [${x}${k.map(d(x)).join(x)}${g}],${h}`;return`{ size: [${f.join(", ")}],${g}x: ${m}, y: ${y}${v}},`};return d(`
`)(l)}}),r}J.version=fe;const _=(e,t=0)=>(e.y=t,(e.children||[]).reduce((n,r)=>{const[a,o]=n;_(r,e.y+e.ySize);const s=(a===0?r.lExt:r.rExt).bottom;a!==0&&ye(e,a,o);const l=Ce(s,a,o);return[a+1,l]},[0,null]),xe(e),Ee(e),e),Q=(e,t,n)=>{typeof t>"u"&&(t=-e.relX-e.prelim,n=0);const r=t+e.relX;return e.relX=r+e.prelim-n,e.prelim=0,e.x=n+e.relX,(e.children||[]).forEach(a=>Q(a,r,e.x)),e},xe=e=>{(e.children||[]).reduce((t,n)=>{const[r,a]=t,o=r+n.shift,s=a+o+n.change;return n.relX+=s,[o,s]},[0,0])},ye=(e,t,n)=>{const r=e.children[t-1],a=e.children[t];let o=r,s=r.relX,l=a,c=a.relX,d=!0;for(;o&&l;){o.bottom>n.lowY&&(n=n.next);const h=s+o.prelim-(c+l.prelim)+o.xSize/2+l.xSize/2+o.spacing(l);(h>0||h<0&&d)&&(c+=h,ve(a,h),ke(e,t,n.index,h)),d=!1;const u=o.bottom,g=l.bottom;u<=g&&(o=Se(o),o&&(s+=o.relX)),u>=g&&(l=be(l),l&&(c+=l.relX))}!o&&l?ze(e,t,l,c):o&&!l&&we(e,t,o,s)},ve=(e,t)=>{e.relX+=t,e.lExtRelX+=t,e.rExtRelX+=t},ke=(e,t,n,r)=>{const a=e.children[t],o=t-n;if(o>1){const s=r/o;e.children[n+1].shift+=s,a.shift-=s,a.change-=r-s}},be=e=>e.hasChildren?e.firstChild:e.lThr,Se=e=>e.hasChildren?e.lastChild:e.rThr,ze=(e,t,n,r)=>{const a=e.firstChild,o=a.lExt,s=e.children[t];o.lThr=n;const l=r-n.relX-a.lExtRelX;o.relX+=l,o.prelim-=l,a.lExt=s.lExt,a.lExtRelX=s.lExtRelX},we=(e,t,n,r)=>{const a=e.children[t],o=a.rExt,s=e.children[t-1];o.rThr=n;const l=r-n.relX-a.rExtRelX;o.relX+=l,o.prelim-=l,a.rExt=s.rExt,a.rExtRelX=s.rExtRelX},Ee=e=>{if(e.hasChildren){const t=e.firstChild,n=e.lastChild,r=(t.prelim+t.relX-t.xSize/2+n.relX+n.prelim+n.xSize/2)/2;Object.assign(e,{prelim:r,lExt:t.lExt,lExtRelX:t.lExtRelX,rExt:n.rExt,rExtRelX:n.rExtRelX})}},Ce=(e,t,n)=>{for(;n!==null&&e>=n.lowY;)n=n.next;return{lowY:e,index:t,next:n}},Xe=".markmap-container{position:absolute;width:0;height:0;top:-100px;left:-100px;overflow:hidden}.markmap-container>.markmap-foreign{display:inline-block}.markmap-container>.markmap-foreign>div:last-child,.markmap-container>.markmap-foreign>div:last-child :not(pre){white-space:nowrap}.markmap-container>.markmap-foreign>div:last-child code{white-space:inherit}",tt=".markmap{--markmap-max-width: none;--markmap-a-color: #0097e6;--markmap-a-hover-color: #00a8ff;--markmap-code-bg: #f0f0f0;--markmap-code-color: #555;--markmap-highlight-bg: #ffeaa7;--markmap-table-border: 1px solid currentColor;--markmap-font: 300 16px/20px sans-serif;--markmap-circle-open-bg: #fff;--markmap-text-color: #333;font:var(--markmap-font);color:var(--markmap-text-color)}.markmap-link{fill:none}.markmap-node>circle{cursor:pointer}.markmap-foreign{display:inline-block}.markmap-foreign p{margin:0}.markmap-foreign a{color:var(--markmap-a-color)}.markmap-foreign a:hover{color:var(--markmap-a-hover-color)}.markmap-foreign code{padding:.25em;font-size:calc(1em - 2px);color:var(--markmap-code-color);background-color:var(--markmap-code-bg);border-radius:2px}.markmap-foreign pre{margin:0}.markmap-foreign pre>code{display:block}.markmap-foreign del{text-decoration:line-through}.markmap-foreign em{font-style:italic}.markmap-foreign strong{font-weight:700}.markmap-foreign mark{background:var(--markmap-highlight-bg)}.markmap-foreign table,.markmap-foreign th,.markmap-foreign td{border-collapse:collapse;border:var(--markmap-table-border)}.markmap-foreign img{display:inline-block}.markmap-foreign svg{fill:currentColor}.markmap-foreign-testing-max{max-width:var(--markmap-max-width)}.markmap-foreign-testing-max img{max-width:var(--markmap-max-width);max-height:none}.markmap-dark .markmap{--markmap-code-bg: #1a1b26;--markmap-code-color: #ddd;--markmap-circle-open-bg: #444;--markmap-text-color: #eee}",Te=tt;function P(e){const t=e.data;return Math.max(4-2*t.state.depth,1.5)}function W(e,t){const n=kt(e,t);return e[n]}function I(e){e.stopPropagation()}const je=new st;class et{constructor(t,n){this.options=U,this.revokers=[],this.imgCache={},this.handleZoom=r=>{const{transform:a}=r;this.g.attr("transform",a)},this.handlePan=r=>{r.preventDefault();const a=A(this.svg.node()),o=a.translate(-r.deltaX/a.k,-r.deltaY/a.k);this.svg.call(this.zoom.transform,o)},this.handleClick=(r,a)=>{let o=this.options.toggleRecursively;(K?r.metaKey:r.ctrlKey)&&(o=!o),this.toggleNode(a.data,o)},this.svg=t.datum?t:dt(t),this.styleNode=this.svg.append("style"),this.zoom=pt().filter(r=>this.options.scrollForPan&&r.type==="wheel"?r.ctrlKey&&!r.button:(!r.ctrlKey||r.type==="wheel")&&!r.button).on("zoom",this.handleZoom),this.setOptions(n),this.state={id:this.options.id||this.svg.attr("id")||lt(),minX:0,maxX:0,minY:0,maxY:0},this.g=this.svg.append("g"),this.debouncedRefresh=ct(()=>this.setData(),200),this.revokers.push(je.tap(()=>{this.setData()}))}getStyleContent(){const{style:t}=this.options,{id:n}=this.state,r=typeof t=="function"?t(n):"";return[this.options.embedGlobalCSS&&tt,r].filter(Boolean).join(`
`)}updateStyle(){this.svg.attr("class",ht(this.svg.attr("class"),"markmap",this.state.id));const t=this.getStyleContent();this.styleNode.text(t)}toggleNode(t,n=!1){var r,a;const o=(r=t.payload)!=null&&r.fold?0:1;n?M(t,(s,l)=>{s.payload={...s.payload,fold:o},l()}):t.payload={...t.payload,fold:(a=t.payload)!=null&&a.fold?0:1},this.renderData(t)}initializeData(t){let n=0;const{color:r,nodeMinHeight:a,maxWidth:o,initialExpandLevel:s}=this.options,{id:l}=this.state,c=B(j("div",{className:`markmap-container markmap ${l}-g`})),d=B(j("style",{children:[this.getStyleContent(),Xe].join(`
`)}));document.body.append(c,d);const h=o?`--markmap-max-width: ${o}px`:"";let u=0,g=0;M(t,(m,y,f)=>{var k,v,S;g+=1,m.children=(k=m.children)==null?void 0:k.map(w=>({...w})),n+=1;const C=B(j("div",{className:"markmap-foreign markmap-foreign-testing-max",style:h,children:j("div",{dangerouslySetInnerHTML:{__html:m.content}})}));c.append(C),m.state={...m.state,depth:g,id:n,el:C.firstChild},m.state.path=[(v=f==null?void 0:f.state)==null?void 0:v.path,m.state.id].filter(Boolean).join("."),r(m);const z=((S=m.payload)==null?void 0:S.fold)===2;z?u+=1:(u||s>=0&&m.state.depth>=s)&&(m.payload={...m.payload,fold:1}),y(),z&&(u-=1),g-=1});const x=Array.from(c.childNodes).map(m=>m.firstChild);this._checkImages(c),x.forEach(m=>{var y;(y=m.parentNode)==null||y.append(m.cloneNode(!0))}),M(t,(m,y,f)=>{var k;const v=m.state,S=v.el.getBoundingClientRect();m.content=v.el.innerHTML,v.size=[Math.ceil(S.width)+1,Math.max(Math.ceil(S.height),a)],v.key=[(k=f==null?void 0:f.state)==null?void 0:k.id,v.id].filter(Boolean).join(".")+m.content,y()}),c.remove(),d.remove()}_checkImages(t){t.querySelectorAll("img").forEach(n=>{if(n.width)return;const r=this.imgCache[n.src];r!=null&&r[0]?[n.width,n.height]=r:r||this._loadImage(n.src)})}_loadImage(t){this.imgCache[t]=[0,0];const n=new Image;n.src=t,n.onload=()=>{this.imgCache[t]=[n.naturalWidth,n.naturalHeight],this.debouncedRefresh()}}setOptions(t){this.options={...this.options,...t},this.options.zoom?this.svg.call(this.zoom):this.svg.on(".zoom",null),this.options.pan?this.svg.on("wheel",this.handlePan):this.svg.on("wheel",null)}setData(t,n){n&&this.setOptions(n),t&&(this.state.data=t),this.state.data&&(this.initializeData(this.state.data),this.updateStyle(),this.renderData())}renderData(t){if(!this.state.data)return;const{spacingHorizontal:n,paddingX:r,spacingVertical:a,autoFit:o,color:s}=this.options,l=J({}).children(i=>{var p;if(!((p=i.payload)!=null&&p.fold))return i.children}).nodeSize(i=>{const[p,b]=i.data.state.size;return[b,p+(p?r*2:0)+n]}).spacing((i,p)=>i.parent===p.parent?a:a*2),c=l.hierarchy(this.state.data);l(c);const d=c.descendants().reverse(),h=c.links(),u=Et(),g=T(d,i=>i.x-i.xSize/2),x=F(d,i=>i.x+i.xSize/2),m=T(d,i=>i.y),y=F(d,i=>i.y+i.ySize-n);Object.assign(this.state,{minX:g,maxX:x,minY:m,maxY:y}),o&&this.fit();const f=t&&d.find(i=>i.data===t)||c,k=f.data.state.x0??f.x,v=f.data.state.y0??f.y,S=this.g.selectAll(E("g")).data(d,i=>i.data.state.key),C=S.enter().append("g").attr("data-depth",i=>i.data.state.depth).attr("data-path",i=>i.data.state.path).attr("transform",i=>`translate(${v+f.ySize-i.ySize},${k+f.xSize/2-i.xSize})`),z=this.transition(S.exit());z.select("line").attr("x1",i=>i.ySize-n).attr("x2",i=>i.ySize-n),z.select("foreignObject").style("opacity",0),z.attr("transform",i=>`translate(${f.y+f.ySize-i.ySize},${f.x+f.xSize/2-i.xSize})`).remove();const w=S.merge(C).attr("class",i=>{var p;return["markmap-node",((p=i.data.payload)==null?void 0:p.fold)&&"markmap-fold"].filter(Boolean).join(" ")});this.transition(w).attr("transform",i=>`translate(${i.y},${i.x-i.xSize/2})`);const nt=w.selectAll(E("line")).data(i=>[i],i=>i.data.state.key).join(i=>i.append("line").attr("x1",p=>p.ySize-n).attr("x2",p=>p.ySize-n),i=>i,i=>i.remove());this.transition(nt).attr("x1",-1).attr("x2",i=>i.ySize-n+2).attr("y1",i=>i.xSize).attr("y2",i=>i.xSize).attr("stroke",i=>s(i.data)).attr("stroke-width",P);const rt=w.selectAll(E("circle")).data(i=>{var p;return(p=i.data.children)!=null&&p.length?[i]:[]},i=>i.data.state.key).join(i=>i.append("circle").attr("stroke-width","1.5").attr("cx",p=>p.ySize-n).attr("cy",p=>p.xSize).attr("r",0).on("click",(p,b)=>this.handleClick(p,b)).on("mousedown",I),i=>i,i=>i.remove());this.transition(rt).attr("r",6).attr("cx",i=>i.ySize-n).attr("cy",i=>i.xSize).attr("stroke",i=>s(i.data)).attr("fill",i=>{var p;return(p=i.data.payload)!=null&&p.fold&&i.data.children?s(i.data):"var(--markmap-circle-open-bg)"});const at=w.selectAll(E("foreignObject")).data(i=>[i],i=>i.data.state.key).join(i=>{const p=i.append("foreignObject").attr("class","markmap-foreign").attr("x",r).attr("y",0).style("opacity",0).on("mousedown",I).on("dblclick",I);return p.append("xhtml:div").select(function(b){const X=b.data.state.el.cloneNode(!0);return this.replaceWith(X),X}).attr("xmlns","http://www.w3.org/1999/xhtml"),p},i=>i,i=>i.remove()).attr("width",i=>Math.max(0,i.ySize-n-r*2)).attr("height",i=>i.xSize);this.transition(at).style("opacity",1);const it=this.g.selectAll(E("path")).data(h,i=>i.target.data.state.key).join(i=>{const p=[v+f.ySize-n,k+f.xSize/2];return i.insert("path","g").attr("class","markmap-link").attr("data-depth",b=>b.target.data.state.depth).attr("data-path",b=>b.target.data.state.path).attr("d",u({source:p,target:p}))},i=>i,i=>{const p=[f.y+f.ySize-n,f.x+f.xSize/2];return this.transition(i).attr("d",u({source:p,target:p})).remove()});this.transition(it).attr("stroke",i=>s(i.target.data)).attr("stroke-width",i=>P(i.target)).attr("d",i=>{const p=i.source,b=i.target,X=[p.y+p.ySize-n,p.x+p.xSize/2],ot=[b.y,b.x+b.xSize/2];return u({source:X,target:ot})}),d.forEach(i=>{i.data.state.x0=i.x,i.data.state.y0=i.y})}transition(t){const{duration:n}=this.options;return t.transition().duration(n)}async fit(t=this.options.maxInitialScale){const n=this.svg.node(),{width:r,height:a}=n.getBoundingClientRect(),{fitRatio:o}=this.options,{minX:s,maxX:l,minY:c,maxY:d}=this.state,h=d-c,u=l-s,g=Math.min(r/h*o,a/u*o,t),x=ut.translate((r-h*g)/2-c*g,(a-u*g)/2-s*g).scale(g);return this.transition(this.svg).call(this.zoom.transform,x).end().catch($)}findElement(t){let n;return this.g.selectAll(E("g")).each(function(r){r.data===t&&(n={data:r,g:this})}),n}async ensureView(t,n){var r;const a=(r=this.findElement(t))==null?void 0:r.data;if(!a)return;const o=this.svg.node(),{spacingHorizontal:s}=this.options,l=o.getBoundingClientRect(),c=A(o),[d,h]=[a.y,a.y+a.ySize-s+2].map(v=>v*c.k+c.x),[u,g]=[a.x-a.xSize/2,a.x+a.xSize/2].map(v=>v*c.k+c.y),x={left:0,right:0,top:0,bottom:0,...n},m=[x.left-d,l.width-x.right-h],y=[x.top-u,l.height-x.bottom-g],f=m[0]*m[1]>0?W(m,Math.abs)/c.k:0,k=y[0]*y[1]>0?W(y,Math.abs)/c.k:0;if(f||k){const v=c.translate(f,k);return this.transition(this.svg).call(this.zoom.transform,v).end().catch($)}}async rescale(t){const n=this.svg.node(),{width:r,height:a}=n.getBoundingClientRect(),o=r/2,s=a/2,l=A(n),c=l.translate((o-l.x)*(1-t)/l.k,(s-l.y)*(1-t)/l.k).scale(t);return this.transition(this.svg).call(this.zoom.transform,c).end().catch($)}destroy(){this.svg.on(".zoom",null),this.svg.html(null),this.revokers.forEach(t=>{t()})}static create(t,n,r=null){const a=new et(t,n);return r&&(a.setData(r),requestAnimationFrame(()=>{a.fit()})),a}}export{et as Markmap,Ct as defaultColorFn,U as defaultOptions,Le as deriveOptions,Te as globalCSS,K as isMacintosh,Pe as loadCSS,We as loadJS,je as refreshHook};
