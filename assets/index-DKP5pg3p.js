import{H as dt,g as ut,d as pt,e as gt,w as X,n as j}from"./index-D2PvbXKv.js";import{f as Ie,l as Fe}from"./index-D2PvbXKv.js";import{t as z,s as mt,j as ft,k as xt}from"./app-DmFyGqwr.js";import{o as q}from"./ordinal-Cboi1Yqb.js";import{c as yt}from"./colors-Cc3OSVma.js";import{s as kt}from"./array-DEnAxiAM.js";import{w as vt,c as W}from"./path-CbwjOpE9.js";import{b as bt}from"./bump-ClWOOmqL.js";import{x as wt,y as zt}from"./point-DWREGWZc.js";import{m as U,a as K}from"./min-tv6RD-6E.js";import"./init-Gi6I4Gst.js";function Et(e,t){let r,a=-1,i=-1;if(t===void 0)for(const o of e)++i,o!=null&&(r>o||r===void 0&&o>=o)&&(r=o,a=i);else for(let o of e)(o=t(o,++i,e))!=null&&(r>o||r===void 0&&o>=o)&&(r=o,a=i);return a}const Ct=yt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function St(e){return e.source}function Xt(e){return e.target}function jt(e){let t=St,r=Xt,a=wt,i=zt,o=null,l=null,s=vt(h);function h(){let d;const c=kt.call(arguments),p=t.apply(this,c),g=r.apply(this,c);if(o==null&&(l=e(d=s())),l.lineStart(),c[0]=p,l.point(+a.apply(this,c),+i.apply(this,c)),c[0]=g,l.point(+a.apply(this,c),+i.apply(this,c)),l.lineEnd(),d)return l=null,d+""||null}return h.source=function(d){return arguments.length?(t=d,h):t},h.target=function(d){return arguments.length?(r=d,h):r},h.x=function(d){return arguments.length?(a=typeof d=="function"?d:W(+d),h):a},h.y=function(d){return arguments.length?(i=typeof d=="function"?d:W(+d),h):i},h.context=function(d){return arguments.length?(d==null?o=l=null:l=e(o=d),h):o},h}function Rt(){return jt(bt)}const G=typeof navigator<"u"&&navigator.userAgent.includes("Macintosh"),At=q(Ct),J={autoFit:!1,color:e=>{var t;return At(`${((t=e.state)==null?void 0:t.path)||""}`)},duration:500,embedGlobalCSS:!0,fitRatio:.95,maxInitialScale:2,maxWidth:0,nodeMinHeight:16,paddingX:8,scrollForPan:G,spacingHorizontal:80,spacingVertical:5,initialExpandLevel:-1,zoom:!0,pan:!0,toggleRecursively:!1};function Oe(e){const t={},r={...e},{color:a,colorFreezeLevel:i}=r;if((a==null?void 0:a.length)===1){const o=a[0];t.color=()=>o}else if(a!=null&&a.length){const o=q(a);t.color=l=>o(`${l.state.path}`)}if(i){const o=t.color||J.color;t.color=l=>(l={...l,state:{...l.state,path:l.state.path.split(".").slice(0,i).join(".")}},o(l))}return["duration","fitRatio","initialExpandLevel","maxInitialScale","maxWidth","nodeMinHeight","paddingX","spacingHorizontal","spacingVertical"].forEach(o=>{const l=r[o];typeof l=="number"&&(t[o]=l)}),["zoom","pan"].forEach(o=>{const l=r[o];l!=null&&(t[o]=!!l)}),t}function $t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return(t>>>0).toString(36)}function k(e){if(typeof e=="string"){const r=e;e=a=>a.matches(r)}const t=e;return function(){let r=Array.from(this.childNodes);return t&&(r=r.filter(a=>t(a))),r}}function Bt(e){var t=0,r=e.children,a=r&&r.length;if(!a)t=1;else for(;--a>=0;)t+=r[a].value;e.value=t}function Mt(){return this.eachAfter(Bt)}function Ot(e){var t=this,r,a=[t],i,o,l;do for(r=a.reverse(),a=[];t=r.pop();)if(e(t),i=t.children,i)for(o=0,l=i.length;o<l;++o)a.push(i[o]);while(a.length);return this}function Dt(e){for(var t=this,r=[t],a,i;t=r.pop();)if(e(t),a=t.children,a)for(i=a.length-1;i>=0;--i)r.push(a[i]);return this}function Ht(e){for(var t=this,r=[t],a=[],i,o,l;t=r.pop();)if(a.push(t),i=t.children,i)for(o=0,l=i.length;o<l;++o)r.push(i[o]);for(;t=a.pop();)e(t);return this}function Lt(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,a=t.children,i=a&&a.length;--i>=0;)r+=a[i].value;t.value=r})}function It(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function Ft(e){for(var t=this,r=Tt(t,e),a=[t];t!==r;)t=t.parent,a.push(t);for(var i=a.length;e!==r;)a.splice(i,0,e),e=e.parent;return a}function Tt(e,t){if(e===t)return e;var r=e.ancestors(),a=t.ancestors(),i=null;for(e=r.pop(),t=a.pop();e===t;)i=e,e=r.pop(),t=a.pop();return i}function Pt(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function Nt(){var e=[];return this.each(function(t){e.push(t)}),e}function Vt(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function _t(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t}function D(e,t){var r=new R(e),a=+e.value&&(r.value=e.value),i,o=[r],l,s,h,d;for(t==null&&(t=Ut);i=o.pop();)if(a&&(i.value=+i.data.value),(s=t(i.data))&&(d=s.length))for(i.children=new Array(d),h=d-1;h>=0;--h)o.push(l=i.children[h]=new R(s[h])),l.parent=i,l.depth=i.depth+1;return r.eachBefore(Yt)}function Wt(){return D(this).eachBefore(Kt)}function Ut(e){return e.children}function Kt(e){e.data=e.data.data}function Yt(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function R(e){this.data=e,this.depth=this.height=0,this.parent=null}R.prototype=D.prototype={constructor:R,count:Mt,each:Ot,eachAfter:Ht,eachBefore:Dt,sum:Lt,sort:It,path:Ft,ancestors:Pt,descendants:Nt,leaves:Vt,links:_t,copy:Wt};const Zt="d3-flextree",qt="2.1.2",Gt="build/d3-flextree.js",Jt="index",Qt={name:"Chris Maloney",url:"http://chrismaloney.org"},te="Flexible tree layout algorithm that allows for variable node sizes.",ee=["d3","d3-module","layout","tree","hierarchy","d3-hierarchy","plugin","d3-plugin","infovis","visualization","2d"],re="https://github.com/klortho/d3-flextree",ne="WTFPL",ae={type:"git",url:"https://github.com/klortho/d3-flextree.git"},ie={clean:"rm -rf build demo test","build:demo":"rollup -c --environment BUILD:demo","build:dev":"rollup -c --environment BUILD:dev","build:prod":"rollup -c --environment BUILD:prod","build:test":"rollup -c --environment BUILD:test",build:"rollup -c",lint:"eslint index.js src","test:main":"node test/bundle.js","test:browser":"node test/browser-tests.js",test:"npm-run-all test:*",prepare:"npm-run-all clean build lint test"},se={"d3-hierarchy":"^1.1.5"},oe={"babel-plugin-external-helpers":"^6.22.0","babel-preset-es2015-rollup":"^3.0.0",d3:"^4.13.0","d3-selection-multi":"^1.0.1",eslint:"^4.19.1",jsdom:"^11.6.2","npm-run-all":"^4.1.2",rollup:"^0.55.3","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-copy":"^0.2.3","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.2","rollup-plugin-uglify":"^3.0.0","uglify-es":"^3.3.9"},le={name:Zt,version:qt,main:Gt,module:Jt,"jsnext:main":"index",author:Qt,description:te,keywords:ee,homepage:re,license:ne,repository:ae,scripts:ie,dependencies:se,devDependencies:oe},{version:he}=le,ce=Object.freeze({children:e=>e.children,nodeSize:e=>e.data.size,spacing:0});function tt(e){const t=Object.assign({},ce,e);function r(s){const h=t[s];return typeof h=="function"?h:()=>h}function a(s){const h=l(o(),s,d=>d.children);return h.update(),h.data}function i(){const s=r("nodeSize"),h=r("spacing");return class Q extends D.prototype.constructor{constructor(c){super(c)}copy(){const c=l(this.constructor,this,p=>p.children);return c.each(p=>p.data=p.data.data),c}get size(){return s(this)}spacing(c){return h(this,c)}get nodes(){return this.descendants()}get xSize(){return this.size[0]}get ySize(){return this.size[1]}get top(){return this.y}get bottom(){return this.y+this.ySize}get left(){return this.x-this.xSize/2}get right(){return this.x+this.xSize/2}get root(){const c=this.ancestors();return c[c.length-1]}get numChildren(){return this.hasChildren?this.children.length:0}get hasChildren(){return!this.noChildren}get noChildren(){return this.children===null}get firstChild(){return this.hasChildren?this.children[0]:null}get lastChild(){return this.hasChildren?this.children[this.numChildren-1]:null}get extents(){return(this.children||[]).reduce((c,p)=>Q.maxExtents(c,p.extents),this.nodeExtents)}get nodeExtents(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}static maxExtents(c,p){return{top:Math.min(c.top,p.top),bottom:Math.max(c.bottom,p.bottom),left:Math.min(c.left,p.left),right:Math.max(c.right,p.right)}}}}function o(){const s=i(),h=r("nodeSize"),d=r("spacing");return class extends s{constructor(c){super(c),Object.assign(this,{x:0,y:0,relX:0,prelim:0,shift:0,change:0,lExt:this,lExtRelX:0,lThr:null,rExt:this,rExtRelX:0,rThr:null})}get size(){return h(this.data)}spacing(c){return d(this.data,c.data)}get x(){return this.data.x}set x(c){this.data.x=c}get y(){return this.data.y}set y(c){this.data.y=c}update(){return et(this),rt(this),this}}}function l(s,h,d){const c=(p,g)=>{const m=new s(p);Object.assign(m,{parent:g,depth:g===null?0:g.depth+1,height:0,length:1});const y=d(p)||[];return m.children=y.length===0?null:y.map(f=>c(f,m)),m.children&&Object.assign(m,m.children.reduce((f,b)=>({height:Math.max(f.height,b.height+1),length:f.length+b.length}),m)),m};return c(h,null)}return Object.assign(a,{nodeSize(s){return arguments.length?(t.nodeSize=s,a):t.nodeSize},spacing(s){return arguments.length?(t.spacing=s,a):t.spacing},children(s){return arguments.length?(t.children=s,a):t.children},hierarchy(s,h){const d=typeof h>"u"?t.children:h;return l(i(),s,d)},dump(s){const h=r("nodeSize"),d=c=>p=>{const g=c+"  ",m=c+"    ",{x:y,y:f}=p,b=h(p),v=p.children||[],E=v.length===0?" ":`,${g}children: [${m}${v.map(d(m)).join(m)}${g}],${c}`;return`{ size: [${b.join(", ")}],${g}x: ${y}, y: ${f}${E}},`};return d(`
`)(s)}}),a}tt.version=he;const et=(e,t=0)=>(e.y=t,(e.children||[]).reduce((r,a)=>{const[i,o]=r;et(a,e.y+e.ySize);const l=(i===0?a.lExt:a.rExt).bottom;i!==0&&ue(e,i,o);const s=ve(l,i,o);return[i+1,s]},[0,null]),de(e),ke(e),e),rt=(e,t,r)=>{typeof t>"u"&&(t=-e.relX-e.prelim,r=0);const a=t+e.relX;return e.relX=a+e.prelim-r,e.prelim=0,e.x=r+e.relX,(e.children||[]).forEach(i=>rt(i,a,e.x)),e},de=e=>{(e.children||[]).reduce((t,r)=>{const[a,i]=t,o=a+r.shift,l=i+o+r.change;return r.relX+=l,[o,l]},[0,0])},ue=(e,t,r)=>{const a=e.children[t-1],i=e.children[t];let o=a,l=a.relX,s=i,h=i.relX,d=!0;for(;o&&s;){o.bottom>r.lowY&&(r=r.next);const c=l+o.prelim-(h+s.prelim)+o.xSize/2+s.xSize/2+o.spacing(s);(c>0||c<0&&d)&&(h+=c,pe(i,c),ge(e,t,r.index,c)),d=!1;const p=o.bottom,g=s.bottom;p<=g&&(o=fe(o),o&&(l+=o.relX)),p>=g&&(s=me(s),s&&(h+=s.relX))}!o&&s?xe(e,t,s,h):o&&!s&&ye(e,t,o,l)},pe=(e,t)=>{e.relX+=t,e.lExtRelX+=t,e.rExtRelX+=t},ge=(e,t,r,a)=>{const i=e.children[t],o=t-r;if(o>1){const l=a/o;e.children[r+1].shift+=l,i.shift-=l,i.change-=a-l}},me=e=>e.hasChildren?e.firstChild:e.lThr,fe=e=>e.hasChildren?e.lastChild:e.rThr,xe=(e,t,r,a)=>{const i=e.firstChild,o=i.lExt,l=e.children[t];o.lThr=r;const s=a-r.relX-i.lExtRelX;o.relX+=s,o.prelim-=s,i.lExt=l.lExt,i.lExtRelX=l.lExtRelX},ye=(e,t,r,a)=>{const i=e.children[t],o=i.rExt,l=e.children[t-1];o.rThr=r;const s=a-r.relX-i.rExtRelX;o.relX+=s,o.prelim-=s,i.rExt=l.rExt,i.rExtRelX=l.rExtRelX},ke=e=>{if(e.hasChildren){const t=e.firstChild,r=e.lastChild,a=(t.prelim+t.relX-t.xSize/2+r.relX+r.prelim+r.xSize/2)/2;Object.assign(e,{prelim:a,lExt:t.lExt,lExtRelX:t.lExtRelX,rExt:r.rExt,rExtRelX:r.rExtRelX})}},ve=(e,t,r)=>{for(;r!==null&&e>=r.lowY;)r=r.next;return{lowY:e,index:t,next:r}},nt=".markmap{--markmap-max-width: 9999px;--markmap-a-color: #0097e6;--markmap-a-hover-color: #00a8ff;--markmap-code-bg: #f0f0f0;--markmap-code-color: #555;--markmap-highlight-bg: #ffeaa7;--markmap-table-border: 1px solid currentColor;--markmap-font: 300 16px/20px sans-serif;--markmap-circle-open-bg: #fff;--markmap-text-color: #333;--markmap-highlight-node-bg: #ff02;font:var(--markmap-font);color:var(--markmap-text-color)}.markmap-link{fill:none}.markmap-node>circle{cursor:pointer}.markmap-foreign{display:inline-block}.markmap-foreign p{margin:0}.markmap-foreign a{color:var(--markmap-a-color)}.markmap-foreign a:hover{color:var(--markmap-a-hover-color)}.markmap-foreign code{padding:.25em;font-size:calc(1em - 2px);color:var(--markmap-code-color);background-color:var(--markmap-code-bg);border-radius:2px}.markmap-foreign pre{margin:0}.markmap-foreign pre>code{display:block}.markmap-foreign del{text-decoration:line-through}.markmap-foreign em{font-style:italic}.markmap-foreign strong{font-weight:700}.markmap-foreign mark{background:var(--markmap-highlight-bg)}.markmap-foreign table,.markmap-foreign th,.markmap-foreign td{border-collapse:collapse;border:var(--markmap-table-border)}.markmap-foreign img{display:inline-block}.markmap-foreign svg{fill:currentColor}.markmap-foreign>div{width:var(--markmap-max-width);text-align:left}.markmap-foreign>div>div{display:inline-block}.markmap-highlight rect{fill:var(--markmap-highlight-node-bg)}.markmap-dark .markmap{--markmap-code-bg: #1a1b26;--markmap-code-color: #ddd;--markmap-circle-open-bg: #444;--markmap-text-color: #eee}",De=nt,B="g.markmap-node",be="path.markmap-link",we="g.markmap-highlight",M=Rt();function Y(e){return Math.max(4-2*e.state.depth,1.5)}function Z(e,t){const r=Et(e,t);return e[r]}function O(e){e.stopPropagation()}const ze=new dt;class at{constructor(t,r){this.options=J,this._disposeList=[],this.handleZoom=a=>{const{transform:i}=a;this.g.attr("transform",i)},this.handlePan=a=>{a.preventDefault();const i=z(this.svg.node()),o=i.translate(-a.deltaX/i.k,-a.deltaY/i.k);this.svg.call(this.zoom.transform,o)},this.handleClick=(a,i)=>{let o=this.options.toggleRecursively;(G?a.metaKey:a.ctrlKey)&&(o=!o),this.toggleNode(i,o)},this.ensureView=this.ensureVisible,this.svg=t.datum?t:mt(t),this.styleNode=this.svg.append("style"),this.zoom=ft().filter(a=>this.options.scrollForPan&&a.type==="wheel"?a.ctrlKey&&!a.button:(!a.ctrlKey||a.type==="wheel")&&!a.button).on("zoom",this.handleZoom),this.setOptions(r),this.state={id:this.options.id||this.svg.attr("id")||ut(),rect:{x1:0,y1:0,x2:0,y2:0}},this.g=this.svg.append("g"),this.g.append("g").attr("class","markmap-highlight"),this._observer=new ResizeObserver(pt(()=>{this.renderData()},100)),this._disposeList.push(ze.tap(()=>{this.setData()}),()=>this._observer.disconnect())}getStyleContent(){const{style:t}=this.options,{id:r}=this.state,a=typeof t=="function"?t(r):"";return[this.options.embedGlobalCSS&&nt,a].filter(Boolean).join(`
`)}updateStyle(){this.svg.attr("class",gt(this.svg.attr("class"),"markmap",this.state.id));const t=this.getStyleContent();this.styleNode.text(t)}async toggleNode(t,r=!1){var a,i;const o=(a=t.payload)!=null&&a.fold?0:1;r?X(t,(l,s)=>{l.payload={...l.payload,fold:o},s()}):t.payload={...t.payload,fold:(i=t.payload)!=null&&i.fold?0:1},await this.renderData(t)}_initializeData(t){let r=0;const{color:a,initialExpandLevel:i}=this.options;let o=0,l=0;return X(t,(s,h,d)=>{var c,p,g,m;l+=1,s.children=(c=s.children)==null?void 0:c.map(f=>({...f})),r+=1,s.state={...s.state,depth:l,id:r,rect:{x:0,y:0,width:0,height:0},size:[0,0]},s.state.key=[(p=d==null?void 0:d.state)==null?void 0:p.id,s.state.id].filter(Boolean).join(".")+$t(s.content),s.state.path=[(g=d==null?void 0:d.state)==null?void 0:g.path,s.state.id].filter(Boolean).join("."),a(s);const y=((m=s.payload)==null?void 0:m.fold)===2;y?o+=1:(o||i>=0&&s.state.depth>=i)&&(s.payload={...s.payload,fold:1}),h(),y&&(o-=1),l-=1}),t}_relayout(){if(!this.state.data)return;this.g.selectAll(k(B)).selectAll(k("foreignObject")).each(function(s){var h;const d=(h=this.firstChild)==null?void 0:h.firstChild,c=[d.scrollWidth,d.scrollHeight];s.state.size=c});const{spacingHorizontal:t,paddingX:r,spacingVertical:a}=this.options,i=tt({}).children(s=>{var h;if(!((h=s.payload)!=null&&h.fold))return s.children}).nodeSize(s=>{const[h,d]=s.data.state.size;return[d,h+(h?r*2:0)+t]}).spacing((s,h)=>s.parent===h.parent?a:a*2),o=i.hierarchy(this.state.data);i(o);const l=o.descendants();l.forEach(s=>{const h=s.data;h.state.rect={x:s.y,y:s.x-s.xSize/2,width:s.ySize-t,height:s.xSize}}),this.state.rect={x1:U(l,s=>s.data.state.rect.x)||0,y1:U(l,s=>s.data.state.rect.y)||0,x2:K(l,s=>s.data.state.rect.x+s.data.state.rect.width)||0,y2:K(l,s=>s.data.state.rect.y+s.data.state.rect.height)||0}}setOptions(t){this.options={...this.options,...t},this.options.zoom?this.svg.call(this.zoom):this.svg.on(".zoom",null),this.options.pan?this.svg.on("wheel",this.handlePan):this.svg.on("wheel",null)}async setData(t,r){r&&this.setOptions(r),t&&(this.state.data=this._initializeData(t)),this.state.data&&(this.updateStyle(),await this.renderData())}async setHighlight(t){this.state.highlight=t||void 0,await this.renderData()}_getHighlightRect(t){const r=this.svg.node(),a=4/z(r).k,i={...t.state.rect};return i.x-=a,i.y-=a,i.width+=2*a,i.height+=2*a,i}async renderData(t){const{paddingX:r,autoFit:a,color:i,maxWidth:o}=this.options,l=this.state.data;if(!l)return;const s={},h={},d=[];X(l,(n,u,x)=>{var w;(w=n.payload)!=null&&w.fold||u(),s[n.state.id]=n,x&&(h[n.state.id]=x.state.id),d.push(n)});const c={},p={},g=n=>{!n||c[n.state.id]||X(n,(u,x)=>{c[u.state.id]=n.state.id,x()})},m=n=>p[c[n.state.id]]||l.state.rect,y=n=>(s[c[n.state.id]]||l).state.rect;p[l.state.id]=l.state.rect,t&&g(t);const{highlight:f}=this.state;let b=this.g.selectAll(k(we)).selectAll(k("rect")).data(f?[this._getHighlightRect(f)]:[]).join("rect").attr("x",n=>n.x).attr("y",n=>n.y).attr("width",n=>n.width).attr("height",n=>n.height);const v=this.g.selectAll(k(B)).each(n=>{p[n.state.id]=n.state.rect}).data(d,n=>n.state.key),E=v.enter().append("g").attr("data-depth",n=>n.state.depth).attr("data-path",n=>n.state.path).each(n=>{g(s[h[n.state.id]])}),C=v.exit().each(n=>{g(s[h[n.state.id]])}),S=v.merge(E).attr("class",n=>{var u;return["markmap-node",((u=n.payload)==null?void 0:u.fold)&&"markmap-fold"].filter(Boolean).join(" ")}),H=S.selectAll(k("line")).data(n=>[n],n=>n.state.key),L=H.enter().append("line").attr("stroke",n=>i(n)).attr("stroke-width",0),I=H.merge(L),F=S.selectAll(k("circle")).data(n=>{var u;return(u=n.children)!=null&&u.length?[n]:[]},n=>n.state.key),T=F.enter().append("circle").attr("stroke-width",0).attr("r",0).on("click",(n,u)=>this.handleClick(n,u)).on("mousedown",O).merge(F).attr("stroke",n=>i(n)).attr("fill",n=>{var u;return(u=n.payload)!=null&&u.fold&&n.children?i(n):"var(--markmap-circle-open-bg)"}),P=this._observer,N=S.selectAll(k("foreignObject")).data(n=>[n],n=>n.state.key),A=N.enter().append("foreignObject").attr("class","markmap-foreign").attr("x",r).attr("y",0).style("opacity",0).on("mousedown",O).on("dblclick",O);A.append("xhtml:div").append("xhtml:div").html(n=>n.content).attr("xmlns","http://www.w3.org/1999/xhtml"),A.each(function(){var n;const u=(n=this.firstChild)==null?void 0:n.firstChild;P.observe(u)});const V=C.selectAll(k("foreignObject"));V.each(function(){var n;const u=(n=this.firstChild)==null?void 0:n.firstChild;P.unobserve(u)});const _=A.merge(N),it=d.flatMap(n=>{var u;return(u=n.payload)!=null&&u.fold?[]:n.children.map(x=>({source:n,target:x}))}),$=this.g.selectAll(k(be)).data(it,n=>n.target.state.key),st=$.exit(),ot=$.enter().insert("path","g").attr("class","markmap-link").attr("data-depth",n=>n.target.state.depth).attr("data-path",n=>n.target.state.path).attr("d",n=>{const u=m(n.target),x=[u.x+u.width,u.y+u.height];return M({source:x,target:x})}).attr("stroke-width",0).merge($);this.svg.style("--markmap-max-width",o?`${o}px`:null),await new Promise(requestAnimationFrame),this._relayout(),b=b.data(f?[this._getHighlightRect(f)]:[]).join("rect"),this.transition(b).attr("x",n=>n.x).attr("y",n=>n.y).attr("width",n=>n.width).attr("height",n=>n.height),E.attr("transform",n=>{const u=m(n);return`translate(${u.x+u.width-n.state.rect.width},${u.y+u.height-n.state.rect.height})`}),this.transition(C).attr("transform",n=>{const u=y(n),x=u.x+u.width-n.state.rect.width,w=u.y+u.height-n.state.rect.height;return`translate(${x},${w})`}).remove(),this.transition(S).attr("transform",n=>`translate(${n.state.rect.x},${n.state.rect.y})`);const lt=C.selectAll(k("line"));this.transition(lt).attr("x1",n=>n.state.rect.width).attr("stroke-width",0),L.attr("x1",n=>n.state.rect.width).attr("x2",n=>n.state.rect.width),I.attr("y1",n=>n.state.rect.height).attr("y2",n=>n.state.rect.height),this.transition(I).attr("x1",-1).attr("x2",n=>n.state.rect.width+2).attr("stroke",n=>i(n)).attr("stroke-width",Y);const ht=C.selectAll(k("circle"));this.transition(ht).attr("r",0).attr("stroke-width",0),T.attr("cx",n=>n.state.rect.width).attr("cy",n=>n.state.rect.height),this.transition(T).attr("r",6).attr("stroke-width","1.5"),this.transition(V).style("opacity",0),_.attr("width",n=>Math.max(0,n.state.rect.width-r*2)).attr("height",n=>n.state.rect.height),this.transition(_).style("opacity",1),this.transition(st).attr("d",n=>{const u=y(n.target),x=[u.x+u.width,u.y+u.height];return M({source:x,target:x})}).attr("stroke-width",0).remove(),this.transition(ot).attr("stroke",n=>i(n.target)).attr("stroke-width",n=>Y(n.target)).attr("d",n=>{const u=n.source,x=n.target,w=[u.state.rect.x+u.state.rect.width,u.state.rect.y+u.state.rect.height],ct=[x.state.rect.x,x.state.rect.y+x.state.rect.height];return M({source:w,target:ct})}),a&&this.fit()}transition(t){const{duration:r}=this.options;return t.transition().duration(r)}async fit(t=this.options.maxInitialScale){const r=this.svg.node(),{width:a,height:i}=r.getBoundingClientRect(),{fitRatio:o}=this.options,{x1:l,y1:s,x2:h,y2:d}=this.state.rect,c=h-l,p=d-s,g=Math.min(a/c*o,i/p*o,t),m=xt.translate((a-c*g)/2-l*g,(i-p*g)/2-s*g).scale(g);return this.transition(this.svg).call(this.zoom.transform,m).end().catch(j)}findElement(t){let r;return this.g.selectAll(k(B)).each(function(a){a===t&&(r={data:a,g:this})}),r}async ensureVisible(t,r){var a;const i=(a=this.findElement(t))==null?void 0:a.data;if(!i)return;const o=this.svg.node(),l=o.getBoundingClientRect(),s=z(o),[h,d]=[i.state.rect.x,i.state.rect.x+i.state.rect.width+2].map(v=>v*s.k+s.x),[c,p]=[i.state.rect.y,i.state.rect.y+i.state.rect.height].map(v=>v*s.k+s.y),g={left:0,right:0,top:0,bottom:0,...r},m=[g.left-h,l.width-g.right-d],y=[g.top-c,l.height-g.bottom-p],f=m[0]*m[1]>0?Z(m,Math.abs)/s.k:0,b=y[0]*y[1]>0?Z(y,Math.abs)/s.k:0;if(f||b){const v=s.translate(f,b);return this.transition(this.svg).call(this.zoom.transform,v).end().catch(j)}}async centerNode(t,r){var a;const i=(a=this.findElement(t))==null?void 0:a.data;if(!i)return;const o=this.svg.node(),l=o.getBoundingClientRect(),s=z(o),h=(i.state.rect.x+i.state.rect.width/2)*s.k+s.x,d=(i.state.rect.y+i.state.rect.height/2)*s.k+s.y,c={left:0,right:0,top:0,bottom:0,...r},p=(c.left+l.width-c.right)/2,g=(c.top+l.height-c.bottom)/2,m=(p-h)/s.k,y=(g-d)/s.k;if(m||y){const f=s.translate(m,y);return this.transition(this.svg).call(this.zoom.transform,f).end().catch(j)}}async rescale(t){const r=this.svg.node(),{width:a,height:i}=r.getBoundingClientRect(),o=a/2,l=i/2,s=z(r),h=s.translate((o-s.x)*(1-t)/s.k,(l-s.y)*(1-t)/s.k).scale(t);return this.transition(this.svg).call(this.zoom.transform,h).end().catch(j)}destroy(){this.svg.on(".zoom",null),this.svg.html(null),this._disposeList.forEach(t=>{t()})}static create(t,r,a=null){const i=new at(t,r);return a&&i.setData(a).then(()=>{i.fit()}),i}}export{at as Markmap,k as childSelector,At as defaultColorFn,J as defaultOptions,Oe as deriveOptions,De as globalCSS,G as isMacintosh,Ie as loadCSS,Fe as loadJS,ze as refreshHook,$t as simpleHash};
