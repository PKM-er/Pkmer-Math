import{H as ut,g as pt,d as gt,e as mt,w as X,n as j}from"./index-D2PvbXKv.js";import{f as Fe,l as Ie}from"./index-D2PvbXKv.js";import{t as E,s as ft,y as xt,j as yt}from"./app-CG8NqOgA.js";import{o as q}from"./ordinal-Cboi1Yqb.js";import{c as kt}from"./colors-Cc3OSVma.js";import{s as vt}from"./array-DEnAxiAM.js";import{w as bt,c as K}from"./path-CbwjOpE9.js";import{b as wt}from"./bump-ClWOOmqL.js";import{x as zt,y as Et}from"./point-DWREGWZc.js";import{m as U,a as Y}from"./min-tv6RD-6E.js";import"./init-Gi6I4Gst.js";function Ct(e,t){let r,a=-1,i=-1;if(t===void 0)for(const o of e)++i,o!=null&&(r>o||r===void 0&&o>=o)&&(r=o,a=i);else for(let o of e)(o=t(o,++i,e))!=null&&(r>o||r===void 0&&o>=o)&&(r=o,a=i);return a}const St=kt("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function Xt(e){return e.source}function jt(e){return e.target}function Rt(e){let t=Xt,r=jt,a=zt,i=Et,o=null,l=null,s=bt(h);function h(){let d;const c=vt.call(arguments),p=t.apply(this,c),g=r.apply(this,c);if(o==null&&(l=e(d=s())),l.lineStart(),c[0]=p,l.point(+a.apply(this,c),+i.apply(this,c)),c[0]=g,l.point(+a.apply(this,c),+i.apply(this,c)),l.lineEnd(),d)return l=null,d+""||null}return h.source=function(d){return arguments.length?(t=d,h):t},h.target=function(d){return arguments.length?(r=d,h):r},h.x=function(d){return arguments.length?(a=typeof d=="function"?d:K(+d),h):a},h.y=function(d){return arguments.length?(i=typeof d=="function"?d:K(+d),h):i},h.context=function(d){return arguments.length?(d==null?o=l=null:l=e(o=d),h):o},h}function At(){return Rt(wt)}const G=typeof navigator<"u"&&navigator.userAgent.includes("Macintosh"),$t=q(St),J=(e=1,t=3,r=2)=>a=>e+t/r**a.state.depth,Q={autoFit:!1,duration:500,embedGlobalCSS:!0,fitRatio:.95,maxInitialScale:2,scrollForPan:G,initialExpandLevel:-1,zoom:!0,pan:!0,toggleRecursively:!1,color:e=>{var t;return $t(`${((t=e.state)==null?void 0:t.path)||""}`)},lineWidth:J(),maxWidth:0,nodeMinHeight:16,paddingX:8,spacingHorizontal:80,spacingVertical:5};function Me(e){const t={},r={...e},{color:a,colorFreezeLevel:i,lineWidth:o}=r;if((a==null?void 0:a.length)===1){const l=a[0];t.color=()=>l}else if(a!=null&&a.length){const l=q(a);t.color=s=>l(`${s.state.path}`)}if(i){const l=t.color||Q.color;t.color=s=>(s={...s,state:{...s.state,path:s.state.path.split(".").slice(0,i).join(".")}},l(s))}if(o){const l=Array.isArray(o)?o:[o,0,1];t.lineWidth=J(...l)}return["duration","fitRatio","initialExpandLevel","maxInitialScale","maxWidth","nodeMinHeight","paddingX","spacingHorizontal","spacingVertical"].forEach(l=>{const s=r[l];typeof s=="number"&&(t[l]=s)}),["zoom","pan"].forEach(l=>{const s=r[l];s!=null&&(t[l]=!!s)}),t}function Bt(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return(t>>>0).toString(36)}function k(e){if(typeof e=="string"){const r=e;e=a=>a.matches(r)}const t=e;return function(){let r=Array.from(this.childNodes);return t&&(r=r.filter(a=>t(a))),r}}function Ot(e){var t=0,r=e.children,a=r&&r.length;if(!a)t=1;else for(;--a>=0;)t+=r[a].value;e.value=t}function Dt(){return this.eachAfter(Ot)}function Mt(e){var t=this,r,a=[t],i,o,l;do for(r=a.reverse(),a=[];t=r.pop();)if(e(t),i=t.children,i)for(o=0,l=i.length;o<l;++o)a.push(i[o]);while(a.length);return this}function Ht(e){for(var t=this,r=[t],a,i;t=r.pop();)if(e(t),a=t.children,a)for(i=a.length-1;i>=0;--i)r.push(a[i]);return this}function Lt(e){for(var t=this,r=[t],a=[],i,o,l;t=r.pop();)if(a.push(t),i=t.children,i)for(o=0,l=i.length;o<l;++o)r.push(i[o]);for(;t=a.pop();)e(t);return this}function Wt(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,a=t.children,i=a&&a.length;--i>=0;)r+=a[i].value;t.value=r})}function Ft(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function It(e){for(var t=this,r=Tt(t,e),a=[t];t!==r;)t=t.parent,a.push(t);for(var i=a.length;e!==r;)a.splice(i,0,e),e=e.parent;return a}function Tt(e,t){if(e===t)return e;var r=e.ancestors(),a=t.ancestors(),i=null;for(e=r.pop(),t=a.pop();e===t;)i=e,e=r.pop(),t=a.pop();return i}function Pt(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function Nt(){var e=[];return this.each(function(t){e.push(t)}),e}function _t(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function Vt(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t}function M(e,t){var r=new R(e),a=+e.value&&(r.value=e.value),i,o=[r],l,s,h,d;for(t==null&&(t=Ut);i=o.pop();)if(a&&(i.value=+i.data.value),(s=t(i.data))&&(d=s.length))for(i.children=new Array(d),h=d-1;h>=0;--h)o.push(l=i.children[h]=new R(s[h])),l.parent=i,l.depth=i.depth+1;return r.eachBefore(Zt)}function Kt(){return M(this).eachBefore(Yt)}function Ut(e){return e.children}function Yt(e){e.data=e.data.data}function Zt(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function R(e){this.data=e,this.depth=this.height=0,this.parent=null}R.prototype=M.prototype={constructor:R,count:Dt,each:Mt,eachAfter:Lt,eachBefore:Ht,sum:Wt,sort:Ft,path:It,ancestors:Pt,descendants:Nt,leaves:_t,links:Vt,copy:Kt};const qt="d3-flextree",Gt="2.1.2",Jt="build/d3-flextree.js",Qt="index",te={name:"Chris Maloney",url:"http://chrismaloney.org"},ee="Flexible tree layout algorithm that allows for variable node sizes.",re=["d3","d3-module","layout","tree","hierarchy","d3-hierarchy","plugin","d3-plugin","infovis","visualization","2d"],ne="https://github.com/klortho/d3-flextree",ae="WTFPL",ie={type:"git",url:"https://github.com/klortho/d3-flextree.git"},se={clean:"rm -rf build demo test","build:demo":"rollup -c --environment BUILD:demo","build:dev":"rollup -c --environment BUILD:dev","build:prod":"rollup -c --environment BUILD:prod","build:test":"rollup -c --environment BUILD:test",build:"rollup -c",lint:"eslint index.js src","test:main":"node test/bundle.js","test:browser":"node test/browser-tests.js",test:"npm-run-all test:*",prepare:"npm-run-all clean build lint test"},oe={"d3-hierarchy":"^1.1.5"},le={"babel-plugin-external-helpers":"^6.22.0","babel-preset-es2015-rollup":"^3.0.0",d3:"^4.13.0","d3-selection-multi":"^1.0.1",eslint:"^4.19.1",jsdom:"^11.6.2","npm-run-all":"^4.1.2",rollup:"^0.55.3","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-copy":"^0.2.3","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.2","rollup-plugin-uglify":"^3.0.0","uglify-es":"^3.3.9"},he={name:qt,version:Gt,main:Jt,module:Qt,"jsnext:main":"index",author:te,description:ee,keywords:re,homepage:ne,license:ae,repository:ie,scripts:se,dependencies:oe,devDependencies:le},{version:ce}=he,de=Object.freeze({children:e=>e.children,nodeSize:e=>e.data.size,spacing:0});function et(e){const t=Object.assign({},de,e);function r(s){const h=t[s];return typeof h=="function"?h:()=>h}function a(s){const h=l(o(),s,d=>d.children);return h.update(),h.data}function i(){const s=r("nodeSize"),h=r("spacing");return class tt extends M.prototype.constructor{constructor(c){super(c)}copy(){const c=l(this.constructor,this,p=>p.children);return c.each(p=>p.data=p.data.data),c}get size(){return s(this)}spacing(c){return h(this,c)}get nodes(){return this.descendants()}get xSize(){return this.size[0]}get ySize(){return this.size[1]}get top(){return this.y}get bottom(){return this.y+this.ySize}get left(){return this.x-this.xSize/2}get right(){return this.x+this.xSize/2}get root(){const c=this.ancestors();return c[c.length-1]}get numChildren(){return this.hasChildren?this.children.length:0}get hasChildren(){return!this.noChildren}get noChildren(){return this.children===null}get firstChild(){return this.hasChildren?this.children[0]:null}get lastChild(){return this.hasChildren?this.children[this.numChildren-1]:null}get extents(){return(this.children||[]).reduce((c,p)=>tt.maxExtents(c,p.extents),this.nodeExtents)}get nodeExtents(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}static maxExtents(c,p){return{top:Math.min(c.top,p.top),bottom:Math.max(c.bottom,p.bottom),left:Math.min(c.left,p.left),right:Math.max(c.right,p.right)}}}}function o(){const s=i(),h=r("nodeSize"),d=r("spacing");return class extends s{constructor(c){super(c),Object.assign(this,{x:0,y:0,relX:0,prelim:0,shift:0,change:0,lExt:this,lExtRelX:0,lThr:null,rExt:this,rExtRelX:0,rThr:null})}get size(){return h(this.data)}spacing(c){return d(this.data,c.data)}get x(){return this.data.x}set x(c){this.data.x=c}get y(){return this.data.y}set y(c){this.data.y=c}update(){return rt(this),nt(this),this}}}function l(s,h,d){const c=(p,g)=>{const m=new s(p);Object.assign(m,{parent:g,depth:g===null?0:g.depth+1,height:0,length:1});const x=d(p)||[];return m.children=x.length===0?null:x.map(y=>c(y,m)),m.children&&Object.assign(m,m.children.reduce((y,v)=>({height:Math.max(y.height,v.height+1),length:y.length+v.length}),m)),m};return c(h,null)}return Object.assign(a,{nodeSize(s){return arguments.length?(t.nodeSize=s,a):t.nodeSize},spacing(s){return arguments.length?(t.spacing=s,a):t.spacing},children(s){return arguments.length?(t.children=s,a):t.children},hierarchy(s,h){const d=typeof h>"u"?t.children:h;return l(i(),s,d)},dump(s){const h=r("nodeSize"),d=c=>p=>{const g=c+"  ",m=c+"    ",{x,y}=p,v=h(p),b=p.children||[],z=b.length===0?" ":`,${g}children: [${m}${b.map(d(m)).join(m)}${g}],${c}`;return`{ size: [${v.join(", ")}],${g}x: ${x}, y: ${y}${z}},`};return d(`
`)(s)}}),a}et.version=ce;const rt=(e,t=0)=>(e.y=t,(e.children||[]).reduce((r,a)=>{const[i,o]=r;rt(a,e.y+e.ySize);const l=(i===0?a.lExt:a.rExt).bottom;i!==0&&pe(e,i,o);const s=be(l,i,o);return[i+1,s]},[0,null]),ue(e),ve(e),e),nt=(e,t,r)=>{typeof t>"u"&&(t=-e.relX-e.prelim,r=0);const a=t+e.relX;return e.relX=a+e.prelim-r,e.prelim=0,e.x=r+e.relX,(e.children||[]).forEach(i=>nt(i,a,e.x)),e},ue=e=>{(e.children||[]).reduce((t,r)=>{const[a,i]=t,o=a+r.shift,l=i+o+r.change;return r.relX+=l,[o,l]},[0,0])},pe=(e,t,r)=>{const a=e.children[t-1],i=e.children[t];let o=a,l=a.relX,s=i,h=i.relX,d=!0;for(;o&&s;){o.bottom>r.lowY&&(r=r.next);const c=l+o.prelim-(h+s.prelim)+o.xSize/2+s.xSize/2+o.spacing(s);(c>0||c<0&&d)&&(h+=c,ge(i,c),me(e,t,r.index,c)),d=!1;const p=o.bottom,g=s.bottom;p<=g&&(o=xe(o),o&&(l+=o.relX)),p>=g&&(s=fe(s),s&&(h+=s.relX))}!o&&s?ye(e,t,s,h):o&&!s&&ke(e,t,o,l)},ge=(e,t)=>{e.relX+=t,e.lExtRelX+=t,e.rExtRelX+=t},me=(e,t,r,a)=>{const i=e.children[t],o=t-r;if(o>1){const l=a/o;e.children[r+1].shift+=l,i.shift-=l,i.change-=a-l}},fe=e=>e.hasChildren?e.firstChild:e.lThr,xe=e=>e.hasChildren?e.lastChild:e.rThr,ye=(e,t,r,a)=>{const i=e.firstChild,o=i.lExt,l=e.children[t];o.lThr=r;const s=a-r.relX-i.lExtRelX;o.relX+=s,o.prelim-=s,i.lExt=l.lExt,i.lExtRelX=l.lExtRelX},ke=(e,t,r,a)=>{const i=e.children[t],o=i.rExt,l=e.children[t-1];o.rThr=r;const s=a-r.relX-i.rExtRelX;o.relX+=s,o.prelim-=s,i.rExt=l.rExt,i.rExtRelX=l.rExtRelX},ve=e=>{if(e.hasChildren){const t=e.firstChild,r=e.lastChild,a=(t.prelim+t.relX-t.xSize/2+r.relX+r.prelim+r.xSize/2)/2;Object.assign(e,{prelim:a,lExt:t.lExt,lExtRelX:t.lExtRelX,rExt:r.rExt,rExtRelX:r.rExtRelX})}},be=(e,t,r)=>{for(;r!==null&&e>=r.lowY;)r=r.next;return{lowY:e,index:t,next:r}},at=".markmap{--markmap-max-width: 9999px;--markmap-a-color: #0097e6;--markmap-a-hover-color: #00a8ff;--markmap-code-bg: #f0f0f0;--markmap-code-color: #555;--markmap-highlight-bg: #ffeaa7;--markmap-table-border: 1px solid currentColor;--markmap-font: 300 16px/20px sans-serif;--markmap-circle-open-bg: #fff;--markmap-text-color: #333;--markmap-highlight-node-bg: #ff02;font:var(--markmap-font);color:var(--markmap-text-color)}.markmap-link{fill:none}.markmap-node>circle{cursor:pointer}.markmap-foreign{display:inline-block}.markmap-foreign p{margin:0}.markmap-foreign a{color:var(--markmap-a-color)}.markmap-foreign a:hover{color:var(--markmap-a-hover-color)}.markmap-foreign code{padding:.25em;font-size:calc(1em - 2px);color:var(--markmap-code-color);background-color:var(--markmap-code-bg);border-radius:2px}.markmap-foreign pre{margin:0}.markmap-foreign pre>code{display:block}.markmap-foreign del{text-decoration:line-through}.markmap-foreign em{font-style:italic}.markmap-foreign strong{font-weight:700}.markmap-foreign mark{background:var(--markmap-highlight-bg)}.markmap-foreign table,.markmap-foreign th,.markmap-foreign td{border-collapse:collapse;border:var(--markmap-table-border)}.markmap-foreign img{display:inline-block}.markmap-foreign svg{fill:currentColor}.markmap-foreign>div{width:var(--markmap-max-width);text-align:left}.markmap-foreign>div>div{display:inline-block}.markmap-highlight rect{fill:var(--markmap-highlight-node-bg)}.markmap-dark .markmap{--markmap-code-bg: #1a1b26;--markmap-code-color: #ddd;--markmap-circle-open-bg: #444;--markmap-text-color: #eee}",He=at,B="g.markmap-node",we="path.markmap-link",ze="g.markmap-highlight",O=At();function Z(e,t){const r=Ct(e,t);return e[r]}function D(e){e.stopPropagation()}const Ee=new ut;class it{constructor(t,r){this.options={...Q},this._disposeList=[],this.handleZoom=a=>{const{transform:i}=a;this.g.attr("transform",i)},this.handlePan=a=>{a.preventDefault();const i=E(this.svg.node()),o=i.translate(-a.deltaX/i.k,-a.deltaY/i.k);this.svg.call(this.zoom.transform,o)},this.handleClick=(a,i)=>{let o=this.options.toggleRecursively;(G?a.metaKey:a.ctrlKey)&&(o=!o),this.toggleNode(i,o)},this.ensureView=this.ensureVisible,this.svg=t.datum?t:ft(t),this.styleNode=this.svg.append("style"),this.zoom=xt().filter(a=>this.options.scrollForPan&&a.type==="wheel"?a.ctrlKey&&!a.button:(!a.ctrlKey||a.type==="wheel")&&!a.button).on("zoom",this.handleZoom),this.setOptions(r),this.state={id:this.options.id||this.svg.attr("id")||pt(),rect:{x1:0,y1:0,x2:0,y2:0}},this.g=this.svg.append("g"),this.g.append("g").attr("class","markmap-highlight"),this._observer=new ResizeObserver(gt(()=>{this.renderData()},100)),this._disposeList.push(Ee.tap(()=>{this.setData()}),()=>this._observer.disconnect())}getStyleContent(){const{style:t}=this.options,{id:r}=this.state,a=typeof t=="function"?t(r):"";return[this.options.embedGlobalCSS&&at,a].filter(Boolean).join(`
`)}updateStyle(){this.svg.attr("class",mt(this.svg.attr("class"),"markmap",this.state.id));const t=this.getStyleContent();this.styleNode.text(t)}async toggleNode(t,r=!1){var a,i;const o=(a=t.payload)!=null&&a.fold?0:1;r?X(t,(l,s)=>{l.payload={...l.payload,fold:o},s()}):t.payload={...t.payload,fold:(i=t.payload)!=null&&i.fold?0:1},await this.renderData(t)}_initializeData(t){let r=0;const{color:a,initialExpandLevel:i}=this.options;let o=0,l=0;return X(t,(s,h,d)=>{var c,p,g,m;l+=1,s.children=(c=s.children)==null?void 0:c.map(y=>({...y})),r+=1,s.state={...s.state,depth:l,id:r,rect:{x:0,y:0,width:0,height:0},size:[0,0]},s.state.key=[(p=d==null?void 0:d.state)==null?void 0:p.id,s.state.id].filter(Boolean).join(".")+Bt(s.content),s.state.path=[(g=d==null?void 0:d.state)==null?void 0:g.path,s.state.id].filter(Boolean).join("."),a(s);const x=((m=s.payload)==null?void 0:m.fold)===2;x?o+=1:(o||i>=0&&s.state.depth>=i)&&(s.payload={...s.payload,fold:1}),h(),x&&(o-=1),l-=1}),t}_relayout(){if(!this.state.data)return;this.g.selectAll(k(B)).selectAll(k("foreignObject")).each(function(h){var d;const c=(d=this.firstChild)==null?void 0:d.firstChild,p=[c.scrollWidth,c.scrollHeight];h.state.size=p});const{lineWidth:t,paddingX:r,spacingHorizontal:a,spacingVertical:i}=this.options,o=et({}).children(h=>{var d;if(!((d=h.payload)!=null&&d.fold))return h.children}).nodeSize(h=>{const[d,c]=h.data.state.size;return[c,d+(d?r*2:0)+a]}).spacing((h,d)=>(h.parent===d.parent?i:i*2)+t(h.data)),l=o.hierarchy(this.state.data);o(l);const s=l.descendants();s.forEach(h=>{const d=h.data;d.state.rect={x:h.y,y:h.x-h.xSize/2,width:h.ySize-a,height:h.xSize}}),this.state.rect={x1:U(s,h=>h.data.state.rect.x)||0,y1:U(s,h=>h.data.state.rect.y)||0,x2:Y(s,h=>h.data.state.rect.x+h.data.state.rect.width)||0,y2:Y(s,h=>h.data.state.rect.y+h.data.state.rect.height)||0}}setOptions(t){this.options={...this.options,...t},this.options.zoom?this.svg.call(this.zoom):this.svg.on(".zoom",null),this.options.pan?this.svg.on("wheel",this.handlePan):this.svg.on("wheel",null)}async setData(t,r){r&&this.setOptions(r),t&&(this.state.data=this._initializeData(t)),this.state.data&&(this.updateStyle(),await this.renderData())}async setHighlight(t){this.state.highlight=t||void 0,await this.renderData()}_getHighlightRect(t){const r=this.svg.node(),a=4/E(r).k,i={...t.state.rect};return i.x-=a,i.y-=a,i.width+=2*a,i.height+=2*a,i}async renderData(t){const{paddingX:r,autoFit:a,color:i,maxWidth:o,lineWidth:l}=this.options,s=this.state.data;if(!s)return;const h={},d={},c=[];X(s,(n,u,f)=>{var w;(w=n.payload)!=null&&w.fold||u(),h[n.state.id]=n,f&&(d[n.state.id]=f.state.id),c.push(n)});const p={},g={},m=n=>{!n||p[n.state.id]||X(n,(u,f)=>{p[u.state.id]=n.state.id,f()})},x=n=>g[p[n.state.id]]||s.state.rect,y=n=>(h[p[n.state.id]]||s).state.rect;g[s.state.id]=s.state.rect,t&&m(t);const{highlight:v}=this.state;let b=this.g.selectAll(k(ze)).selectAll(k("rect")).data(v?[this._getHighlightRect(v)]:[]).join("rect").attr("x",n=>n.x).attr("y",n=>n.y).attr("width",n=>n.width).attr("height",n=>n.height);const z=this.g.selectAll(k(B)).each(n=>{g[n.state.id]=n.state.rect}).data(c,n=>n.state.key),H=z.enter().append("g").attr("data-depth",n=>n.state.depth).attr("data-path",n=>n.state.path).each(n=>{m(h[d[n.state.id]])}),C=z.exit().each(n=>{m(h[d[n.state.id]])}),S=z.merge(H).attr("class",n=>{var u;return["markmap-node",((u=n.payload)==null?void 0:u.fold)&&"markmap-fold"].filter(Boolean).join(" ")}),L=S.selectAll(k("line")).data(n=>[n],n=>n.state.key),W=L.enter().append("line").attr("stroke",n=>i(n)).attr("stroke-width",0),F=L.merge(W),I=S.selectAll(k("circle")).data(n=>{var u;return(u=n.children)!=null&&u.length?[n]:[]},n=>n.state.key),T=I.enter().append("circle").attr("stroke-width",0).attr("r",0).on("click",(n,u)=>this.handleClick(n,u)).on("mousedown",D).merge(I).attr("stroke",n=>i(n)).attr("fill",n=>{var u;return(u=n.payload)!=null&&u.fold&&n.children?i(n):"var(--markmap-circle-open-bg)"}),P=this._observer,N=S.selectAll(k("foreignObject")).data(n=>[n],n=>n.state.key),A=N.enter().append("foreignObject").attr("class","markmap-foreign").attr("x",r).attr("y",0).style("opacity",0).on("mousedown",D).on("dblclick",D);A.append("xhtml:div").append("xhtml:div").html(n=>n.content).attr("xmlns","http://www.w3.org/1999/xhtml"),A.each(function(){var n;const u=(n=this.firstChild)==null?void 0:n.firstChild;P.observe(u)});const _=C.selectAll(k("foreignObject"));_.each(function(){var n;const u=(n=this.firstChild)==null?void 0:n.firstChild;P.unobserve(u)});const V=A.merge(N),st=c.flatMap(n=>{var u;return(u=n.payload)!=null&&u.fold?[]:n.children.map(f=>({source:n,target:f}))}),$=this.g.selectAll(k(we)).data(st,n=>n.target.state.key),ot=$.exit(),lt=$.enter().insert("path","g").attr("class","markmap-link").attr("data-depth",n=>n.target.state.depth).attr("data-path",n=>n.target.state.path).attr("d",n=>{const u=x(n.target),f=[u.x+u.width,u.y+u.height];return O({source:f,target:f})}).attr("stroke-width",0).merge($);this.svg.style("--markmap-max-width",o?`${o}px`:null),await new Promise(requestAnimationFrame),this._relayout(),b=b.data(v?[this._getHighlightRect(v)]:[]).join("rect"),this.transition(b).attr("x",n=>n.x).attr("y",n=>n.y).attr("width",n=>n.width).attr("height",n=>n.height),H.attr("transform",n=>{const u=x(n);return`translate(${u.x+u.width-n.state.rect.width},${u.y+u.height-n.state.rect.height})`}),this.transition(C).attr("transform",n=>{const u=y(n),f=u.x+u.width-n.state.rect.width,w=u.y+u.height-n.state.rect.height;return`translate(${f},${w})`}).remove(),this.transition(S).attr("transform",n=>`translate(${n.state.rect.x},${n.state.rect.y})`);const ht=C.selectAll(k("line"));this.transition(ht).attr("x1",n=>n.state.rect.width).attr("stroke-width",0),W.attr("x1",n=>n.state.rect.width).attr("x2",n=>n.state.rect.width),F.attr("y1",n=>n.state.rect.height+l(n)/2).attr("y2",n=>n.state.rect.height+l(n)/2),this.transition(F).attr("x1",-1).attr("x2",n=>n.state.rect.width+2).attr("stroke",n=>i(n)).attr("stroke-width",l);const ct=C.selectAll(k("circle"));this.transition(ct).attr("r",0).attr("stroke-width",0),T.attr("cx",n=>n.state.rect.width).attr("cy",n=>n.state.rect.height+l(n)/2),this.transition(T).attr("r",6).attr("stroke-width","1.5"),this.transition(_).style("opacity",0),V.attr("width",n=>Math.max(0,n.state.rect.width-r*2)).attr("height",n=>n.state.rect.height),this.transition(V).style("opacity",1),this.transition(ot).attr("d",n=>{const u=y(n.target),f=[u.x+u.width,u.y+u.height+l(n.target)/2];return O({source:f,target:f})}).attr("stroke-width",0).remove(),this.transition(lt).attr("stroke",n=>i(n.target)).attr("stroke-width",n=>l(n.target)).attr("d",n=>{const u=n.source,f=n.target,w=[u.state.rect.x+u.state.rect.width,u.state.rect.y+u.state.rect.height+l(u)/2],dt=[f.state.rect.x,f.state.rect.y+f.state.rect.height+l(f)/2];return O({source:w,target:dt})}),a&&this.fit()}transition(t){const{duration:r}=this.options;return t.transition().duration(r)}async fit(t=this.options.maxInitialScale){const r=this.svg.node(),{width:a,height:i}=r.getBoundingClientRect(),{fitRatio:o}=this.options,{x1:l,y1:s,x2:h,y2:d}=this.state.rect,c=h-l,p=d-s,g=Math.min(a/c*o,i/p*o,t),m=yt.translate((a-c*g)/2-l*g,(i-p*g)/2-s*g).scale(g);return this.transition(this.svg).call(this.zoom.transform,m).end().catch(j)}findElement(t){let r;return this.g.selectAll(k(B)).each(function(a){a===t&&(r={data:a,g:this})}),r}async ensureVisible(t,r){var a;const i=(a=this.findElement(t))==null?void 0:a.data;if(!i)return;const o=this.svg.node(),l=o.getBoundingClientRect(),s=E(o),[h,d]=[i.state.rect.x,i.state.rect.x+i.state.rect.width+2].map(b=>b*s.k+s.x),[c,p]=[i.state.rect.y,i.state.rect.y+i.state.rect.height].map(b=>b*s.k+s.y),g={left:0,right:0,top:0,bottom:0,...r},m=[g.left-h,l.width-g.right-d],x=[g.top-c,l.height-g.bottom-p],y=m[0]*m[1]>0?Z(m,Math.abs)/s.k:0,v=x[0]*x[1]>0?Z(x,Math.abs)/s.k:0;if(y||v){const b=s.translate(y,v);return this.transition(this.svg).call(this.zoom.transform,b).end().catch(j)}}async centerNode(t,r){var a;const i=(a=this.findElement(t))==null?void 0:a.data;if(!i)return;const o=this.svg.node(),l=o.getBoundingClientRect(),s=E(o),h=(i.state.rect.x+i.state.rect.width/2)*s.k+s.x,d=(i.state.rect.y+i.state.rect.height/2)*s.k+s.y,c={left:0,right:0,top:0,bottom:0,...r},p=(c.left+l.width-c.right)/2,g=(c.top+l.height-c.bottom)/2,m=(p-h)/s.k,x=(g-d)/s.k;if(m||x){const y=s.translate(m,x);return this.transition(this.svg).call(this.zoom.transform,y).end().catch(j)}}async rescale(t){const r=this.svg.node(),{width:a,height:i}=r.getBoundingClientRect(),o=a/2,l=i/2,s=E(r),h=s.translate((o-s.x)*(1-t)/s.k,(l-s.y)*(1-t)/s.k).scale(t);return this.transition(this.svg).call(this.zoom.transform,h).end().catch(j)}destroy(){this.svg.on(".zoom",null),this.svg.html(null),this._disposeList.forEach(t=>{t()})}static create(t,r,a=null){const i=new it(t,r);return a&&i.setData(a).then(()=>{i.fit()}),i}}export{it as Markmap,k as childSelector,$t as defaultColorFn,Q as defaultOptions,Me as deriveOptions,He as globalCSS,G as isMacintosh,J as lineWidthFactory,Fe as loadCSS,Ie as loadJS,Ee as refreshHook,Bt as simpleHash};
